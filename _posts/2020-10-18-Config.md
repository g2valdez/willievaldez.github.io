---
layout: post
title: (WIP) Making a Config System (A Typeless Container Pt II)
subtitle: Electric Boogaloo
tags: [cpp, oop]
---
AttributeContainer.h
```cpp
#pragma once

#include <string>
#include <unordered_map>
#include <glad/glad.h> // gl function calls
#include <GLFW/glfw3.h> // openGL calls (GLFW), GLint, GLuint

class AttributeContainer
{
public:
	template<typename T>
	void AddAttribute(const std::string& attributeName, T* obj)
	{
		m_map[attributeName] = new TemplatedAttributeWrapper<T>(obj);
	};

	void SetAttribute(const std::string& key, const std::string& val)
	{
		auto foundAttr = m_map.find(key);
		if (foundAttr != m_map.end())
		{
			foundAttr->second->SetAttribute(val);
		}
		else
		{
			printf("Unknown Attribute: %s with value %s\n", key.c_str(), val.c_str());
		}
	}

private:
	class AttributeWrapper
	{
	public:
		virtual void SetAttribute(const std::string& rawVal) = 0;
	};

	template<typename T>
	class TemplatedAttributeWrapper : public AttributeWrapper
	{
	public:
		TemplatedAttributeWrapper(T* data) : m_data(data) {};

		void SetAttribute(const std::string& rawVal) override;
	private:
		T* m_data;
	};

	std::unordered_map<std::string, AttributeWrapper*> m_map;
};

#define SET_ATTRIBUTE_IMPL(TYPE) void AttributeContainer::TemplatedAttributeWrapper<TYPE>::SetAttribute(const std::string& rawVal)
```
Config.h
```cpp
#pragma once

#include <string>
#include <Game/AttributeContainer.h>

#define INSTALL_DIR std::string("../../")

struct Config
{
	bool loaded = false;

#define ConfigKey(type, varName, defaultVal) type varName = defaultVal;
#include <ConfigKeys.inl>
#undef ConfigKey

	AttributeContainer GetExpectedAttributes()
	{
		AttributeContainer attributeContainer;
#define ConfigKey(type, varName, defaultVal) attributeContainer.AddAttribute(#varName, &varName)
#include <ConfigKeys.inl>
#undef ConfigKey
		return attributeContainer;
	};
};

const Config& GetConfig();

```
ConfigKeys.inl
```cpp
ConfigKey(bool, useSteam, false);
ConfigKey(bool, useVR, false);
ConfigKey(bool, is3D, false);
ConfigKey(float, tileSize, 2.0f);
ConfigKey(int, windowWidth, 1920);
ConfigKey(int, windowHeight, 1080);
ConfigKey(int, ticksPerSecond, 60);
```
Config.cpp
```cpp
#include <Config.h>

#include <fstream>
#include <sstream>
#include <algorithm>

const Config& GetConfig()
{
	static Config config;

	if (!config.loaded)
	{
		AttributeContainer attributeContainer = config.GetExpectedAttributes();

		// load the config
		std::string line;
		std::ifstream myfile(INSTALL_DIR + "Assets/config.txt");
		if (myfile.is_open())
		{
			while (getline(myfile, line))
			{
				std::stringstream lineStream(line);
				std::string key, val;
				getline(lineStream, key, '=');
				getline(lineStream, val, '=');
				attributeContainer.SetAttribute(key, val);
			}

			config.loaded = true;
		}
	}
	// Code to load and set the configuration variables
	return config;
}
```
Usage Example
```cpp
	const Config& config = GetConfig();
	if (config.useSteam)
	{
		...
	}
	if (config.useVR)
	{
		...
	}

```